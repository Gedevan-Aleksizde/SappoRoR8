---
title: |
  | R Markdownとbeamerで
  | プレゼンテーション資料作成
subtitle: "SappoRo.R #8 @ 北海学園大学"
author: "伊東宏樹"
date: "2018-02-24"
output:
  beamer_presentation:
    theme: default          # テーマ
    latex_engine: lualatex  # lualatexを使用
    keep_tex: true          # texソースをのこす
    includes:
      in_header: header.tex # header.texをよみこむ
    fig_caption: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# 自己紹介

- Twitter: @monotropastrum

- Blog: http://ito-hi.blog.so-net.ne.jp/

- GitHub: https://github.com/ito4303
    - \small 今回の資料 https://github.com/ito4303/SappoRoR8

- researchmap: https://researchmap.jp/read0208767/


# ありがとうぞうさん

\begin{center}
\includegraphics[width=6cm]{kazutan_SappoRoR6.png}
\end{center}

SappoRo.R #6: R Markdownによるスライド生成（前田さん）

http://kazutan.github.io/SappoRoR6/rmd_slide.html


# その後

>- \Large revealjsをためてしてみた
    - \Large なかなかよかった

>- \Large 次はR Markdown + Beamerでやってみよう

# Beamerとは

\Large \LaTeX でプレゼンテーションファイル(PDF)を作成するパッケージ


# R Markdown + Beamer

新規R Markdown作成時に、
Beamerでプレゼンテーションファイルを作成するオプションあり。

\begin{center}
\includegraphics[width=9cm]{NewRmd.png}
\end{center}

<!--
# なぜR Markdown

- \Large RStudioで完結
- \Large 作業を自動化
- \Large コピー&ペーストを撲滅
-->


# 用意したもの

- \Large RStudio
- \Large TeXLive 2017 (MacTeX 2017)

# 使用方法{.fragile}

ふつうにR Markdown

```
# タイトル

内容
内容

```


# yamlヘッダの設定{.fragile}

\begin{lstlisting}[basicstyle={\footnotesize\ttfamily}]
title: |
  | R Markdownとbeamerで
  | プレゼンテーション資料作成
subtitle: "SappoRo.R #8 @ 北海学園大学"
author: "伊東宏樹"
date: "2018-02-24"
output:
  beamer_presentation:
    theme: default          # テーマ
    latex_engine: lualatex  # lualatexを使用
    keep_tex: true          # texソースをのこす
    includes:
      in_header: header.tex # header.texをよみこむ
    fig_caption: false
\end{lstlisting}

title中の改行は‘|’をいれる。
\footnotesize (https://stackoverflow.com/questions/28895109/how-can-i-force-a-line-break-in-rmarkdowns-title)


# 日本語フォントの設定{.fragile}

yamlヘッダで
\begin{lstlisting}
mainfont: NotoSansCJKjp
\end{lstlisting}
などとするか、
あるいは
`in-header`で指定したファイルでLaTeX環境の日本語フォントを指定するとよいみたい。
\begin{lstlisting}[language=TeX]
\usepackage{luatexja-otf}
\usepackage[match,deluxe,expert,noto-otf]{luatexja-preset}
\renewcommand{\kanjifamilydefault}{\gtdefault}
\end{lstlisting}

- 上のyamlヘッダは、LaTeXソースでは`\setmainfont[]{NotoSansCJKjp}`に変換される。




# luatexjaの設定

luatexjaの公式ドキュメントがくわしい（当然）。

- コマンドラインから`texdoc luatexja`

または

- http://mirrors.ctan.org/macros/luatex/generic/luatexja/doc/luatexja-ja.pdf


# fragile関係のエラー{.fragile}

\begin{Verbatim}[frame=single]
! Illegal parameter number in definition of
\beamer@doifinframe.
\end{Verbatim}
といったエラーが出るとき
（LaTeXのfancyvrbパッケージのVerbatim環境をつかったときなど）

**解決法:** タイトルのあとに`{.fragile}`をつける。
\begin{lstlisting}
# タイトル{.fragile}

……

\end{lstlisting}


# 数式{.fragile}

LaTeXなので、数式は問題なし。RStudioではプレビューも表示される。

\begin{lstlisting}[language=TeX]
\[
\Pr(x \mid \mu, \sigma) =
  \frac{1}{\sqrt{2\pi}\sigma}
  \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
\]
\end{lstlisting}

\[
\Pr(x \mid \mu, \sigma) =
  \frac{1}{\sqrt{2\pi}\sigma}
  \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
\]


# Rでグラフ

Rなので、グラフも
```{r,include=FALSE}
library(ggplot2)
```

しかし、デフォルトでは はみでる。
```{r fig,echo=TRUE}
p <- ggplot(iris, aes(Sepal.Length, Sepal.Width,
                      colour = Species)) +
  geom_point()
print(p)
```

# チャンクでのオプション指定

ドキュメントをみる。

- knitr > Chunk options and package options (Yihui Xieさん)
    - https://yihui.name/knitr/options/#plots

# サイズ調整

チャンクオプションで`fig.width=4,fig.height=2.5`と`out.height="5cm"`を指定した。
```{r fig_size,fig.width=4,fig.height=2.5,out.height="5cm",echo=TRUE}
print(p)
```


# 日本語フォント

チャンクオプションで、 `dev="cairo_pdf"`を指定した。
```{r fig_font,fig.width=5,fig.height=2,out.height="4cm",dev="cairo_pdf",echo=TRUE}
spc <- c("ヒオウギアヤメ", "イリス・ウェルシコロル",
         "イリス・ヴァージニカ")
p + labs(x = "萼の長さ", y = "萼の幅") +
         scale_colour_discrete(name = "種", labels = spc) +
         theme_grey(base_family = "NotoSansCJKjp-Regular")
```

# まとめ
>- \Large CSSの知識があれば、revealjsの方が楽かも。
>- \Large でも、なんとかなる
>- \Large 先人の知恵を活用する
>- \Large いったん設定ができてしまえば、あとは楽？



